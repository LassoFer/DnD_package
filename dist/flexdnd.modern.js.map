{"version":3,"file":"flexdnd.modern.js","sources":["../src/DragAndDrop/DandDMethods.js","../src/DragAndDrop/index.js","../src/DragAndDrop/DragAndDrop.js"],"sourcesContent":["import { createRef } from 'react';\r\n\r\n/////First render methods////////\r\n\r\nexport const createElementReferences = (list_, setList) => {\r\n  if (!list_ || list_.length === 0) return;\r\n  setList(\r\n    list_.map((l) => {\r\n      l['ref'] = createRef();\r\n      l['x'] = 0;\r\n      l['y'] = 0;\r\n      return l;\r\n    }),\r\n  );\r\n};\r\n\r\n////Starting dragging////\r\n\r\nexport const initialPos = (ref, draggedEl, contRef) => {\r\n  const coords = ref.current.getBoundingClientRect();\r\n  const coordsCont = contRef.current.getBoundingClientRect();\r\n  draggedEl.x = coords.x - coordsCont.x;\r\n  draggedEl.y = coords.y - coordsCont.y;\r\n};\r\n\r\nexport const addEmpty = (ref, draggedIndex, draggedEl, list) => {\r\n  list.splice(draggedIndex, 0, {\r\n    _id: 'empty',\r\n    extraStyle: {\r\n      width: ref.current.offsetWidth,\r\n      height: ref.current.offsetHeight,\r\n    },\r\n  });\r\n  draggedEl['extraStyle'] = {\r\n    width: ref.current.offsetWidth,\r\n    height: ref.current.offsetHeight,\r\n  };\r\n};\r\n\r\n////Moving methods////\r\n\r\nexport const moveElement = (draggedElement, evt) => {\r\n  let difx = draggedElement.x + evt.pageX - draggedElement.mouseDown.pageX;\r\n  let dify = draggedElement.y + evt.pageY - draggedElement.mouseDown.pageY;\r\n  draggedElement.ref.current.style.transform = 'translate(' + difx + 'px,' + dify + 'px)';\r\n};\r\n\r\nexport const moveElements = (draggedElement, setDraggedElement, list, setList, draggedIndex, i) => {\r\n  draggedElement['enable'] = true;\r\n  setDraggedElement(Object.assign(draggedElement));\r\n  let elements = list.splice(draggedIndex, 1);\r\n  list.splice(i, 0, ...elements);\r\n  setList([...list]);\r\n};\r\n\r\nexport const isInside = (ref, el) => {\r\n  let coords = el.ref?.current.getBoundingClientRect();\r\n  let refCoords = ref.current.getBoundingClientRect();\r\n  let middleY = refCoords.y + refCoords.height / 2;\r\n  let middleX = refCoords.x + refCoords.width / 2;\r\n  let elCoords = {\r\n    x: coords.x,\r\n    xM: coords.width,\r\n    y: coords.y,\r\n    yM: coords.bottom,\r\n  };\r\n\r\n  let inside =\r\n    middleX > elCoords.x && middleX < elCoords.x + elCoords.xM && middleY > elCoords.y && middleY < elCoords.yM;\r\n  return inside;\r\n};\r\n\r\nexport const setTemp = (draggedElement, setDraggedElement) =>\r\n  setTimeout(() => {\r\n    draggedElement['enable'] = false;\r\n    setDraggedElement(Object.assign(draggedElement));\r\n  }, 200);\r\n","import * as FormkitAutoAnimateReact from '@formkit/auto-animate/react';\r\nimport DragAndDrop from './DragAndDrop';\r\nexport default { DragAndDrop, FormkitAutoAnimateReact };\r\n","import * as FormkitAutoAnimateReact from '@formkit/auto-animate/react';\r\nimport { useEffect, useState } from 'react';\r\nimport {\r\n  addEmpty,\r\n  createElementReferences,\r\n  initialPos,\r\n  isInside,\r\n  moveElement,\r\n  moveElements,\r\n  setTemp,\r\n} from './DandDMethods';\r\n\r\nexport default function DragAndDrop({ duration, list_, contRef, elementclassName, containerclassName }) {\r\n  const [list, setList] = useState(list_);\r\n  const [draggedElement, setDraggedElement] = useState(undefined);\r\n  const [parent, enableAnimations] = FormkitAutoAnimateReact.useAutoAnimate({ duration: duration });\r\n\r\n  useEffect(() => {\r\n    createElementReferences(list_, setList);\r\n  }, [list_]);\r\n\r\n  useEffect(() => {\r\n    if (!draggedElement) return;\r\n\r\n    const handleMouseMove = (evt) => {\r\n      moveElement(draggedElement, evt);\r\n      moveEmptyElement(draggedElement.ref, evt);\r\n    };\r\n\r\n    const handleMouseUp = (evt) => {\r\n      handleDrop(list.findIndex((el) => el._id === 'empty'));\r\n      document.removeEventListener('mousemove', handleMouseMove);\r\n      document.removeEventListener('mouseup', handleMouseUp);\r\n    };\r\n\r\n    document.addEventListener('mousemove', handleMouseMove);\r\n    document.addEventListener('mouseup', handleMouseUp);\r\n  }, [draggedElement]);\r\n\r\n  const moveEmptyElement = (ref) => {\r\n    let draggedEl = list.find((el) => el.dragged);\r\n    let draggedIndex = list.findIndex((el) => el._id === 'empty');\r\n\r\n    for (let i = 0; i < list.length; i++) {\r\n      let el = list[i];\r\n      if (!draggedElement.enable && el !== draggedEl && el._id !== 'empty' && isInside(ref, el)) {\r\n        moveElements(draggedElement, setDraggedElement, list, setList, draggedIndex, i); //set enable animtion to false and set new state\r\n        setTemp(draggedElement, setDraggedElement); //Does not let to move empty until animation is finished\r\n        break;\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDrop = (draggedIndex) => {\r\n    let newList = list.filter((rd) => rd._id !== 'empty');\r\n    newList.splice(draggedIndex, 0, draggedElement);\r\n    setDraggedElement(undefined);\r\n    setList([...newList]);\r\n  };\r\n\r\n  const handleDrag = async (mouseDown, ref) => {\r\n    mouseDown.stopPropagation();\r\n    let draggedEl = list.find((el) => el.ref === ref);\r\n    let draggedIndex = list.findIndex((el) => el.ref === ref);\r\n    initialPos(ref, draggedEl, contRef);\r\n    addEmpty(ref, draggedIndex, draggedEl, list);\r\n    setList(list.filter((r) => r !== draggedEl));\r\n    draggedEl['mouseDown'] = mouseDown;\r\n    setDraggedElement(draggedEl);\r\n  };\r\n\r\n  return (\r\n    <div style={{ display: 'flex' }}>\r\n      {list && (\r\n        <div ref={parent} className={containerclassName}>\r\n          {list.map((l) => {\r\n            return (\r\n              <div\r\n                ref={l.ref}\r\n                className={elementclassName}\r\n                key={l._id}\r\n                onMouseDown={(evt) => handleDrag(evt, l.ref)}\r\n                style={l.extraStyle ? { ...l.extraStyle } : {}}\r\n              >\r\n                {l.renderMethod}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n      {draggedElement && (\r\n        <div\r\n          className=\"dashboardContainer\"\r\n          ref={draggedElement.ref}\r\n          style={{\r\n            position: 'absolute',\r\n            ...draggedElement.extraStyle,\r\n            transform: 'translate(' + draggedElement.x + 'px,' + draggedElement.y + 'px)',\r\n            zIndex: '10000',\r\n          }}\r\n        >\r\n          {draggedElement.renderMethod}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["moveElements","draggedElement","setDraggedElement","list","setList","draggedIndex","i","Object","assign","elements","splice","isInside","ref","el","_el$ref","coords","current","getBoundingClientRect","refCoords","middleY","y","height","middleX","x","width","elCoords","bottom","inside","setTemp","setTimeout","DragAndDrop","duration","list_","contRef","elementclassName","containerclassName","useState","undefined","parent","enableAnimations","FormkitAutoAnimateReact","useAutoAnimate","useEffect","createElementReferences","length","map","l","createRef","handleMouseMove","evt","moveElement","style","transform","pageX","mouseDown","pageY","moveEmptyElement","handleMouseUp","handleDrop","findIndex","_id","document","removeEventListener","addEventListener","draggedEl","find","dragged","enable","newList","filter","rd","h","display","className","key","onMouseDown","async","stopPropagation","initialPos","coordsCont","addEmpty","extraStyle","offsetWidth","offsetHeight","r","handleDrag","_extends","renderMethod","position","zIndex"],"mappings":"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"}