{"version":3,"file":"flex_dnd.cjs","sources":["../src/DandDMethods.js","../src/index.js","../src/DragAndDrop.js"],"sourcesContent":["import { createRef } from 'react';\r\n\r\n/////First render methods////////\r\n\r\nexport const createElementReferences = (list_, setList) => {\r\n  if (!list_ || list_.length === 0) return;\r\n  setList(\r\n    list_.map((l) => {\r\n      l['ref'] = createRef();\r\n      l['x'] = 0;\r\n      l['y'] = 0;\r\n      return l;\r\n    }),\r\n  );\r\n};\r\n\r\n////Starting dragging////\r\n\r\nexport const initialPos = (ref, draggedEl, contRef) => {\r\n  const coords = ref.current.getBoundingClientRect();\r\n  const coordsCont = contRef.current.getBoundingClientRect();\r\n  draggedEl.x = coords.x - coordsCont.x;\r\n  draggedEl.y = coords.y - coordsCont.y;\r\n};\r\n\r\nexport const addEmpty = (ref, draggedIndex, draggedEl, list) => {\r\n  list.splice(draggedIndex, 0, {\r\n    _id: 'empty',\r\n    extraStyle: {\r\n      width: ref.current.offsetWidth,\r\n      height: ref.current.offsetHeight,\r\n    },\r\n  });\r\n  draggedEl['extraStyle'] = {\r\n    width: ref.current.offsetWidth,\r\n    height: ref.current.offsetHeight,\r\n  };\r\n};\r\n\r\n////Moving methods////\r\n\r\nexport const moveElement = (draggedElement, evt) => {\r\n  let difx = draggedElement.x + evt.pageX - draggedElement.mouseDown.pageX;\r\n  let dify = draggedElement.y + evt.pageY - draggedElement.mouseDown.pageY;\r\n  draggedElement.ref.current.style.transform = 'translate(' + difx + 'px,' + dify + 'px)';\r\n};\r\n\r\nexport const moveElements = (draggedElement, setDraggedElement, list, setList, draggedIndex, i) => {\r\n  draggedElement['enable'] = true;\r\n  setDraggedElement(Object.assign(draggedElement));\r\n  let elements = list.splice(draggedIndex, 1);\r\n  list.splice(i, 0, ...elements);\r\n  setList([...list]);\r\n};\r\n\r\nexport const isInside = (ref, el) => {\r\n  let coords = el.ref?.current.getBoundingClientRect();\r\n  let refCoords = ref.current.getBoundingClientRect();\r\n  let middleY = refCoords.y + refCoords.height / 2;\r\n  let middleX = refCoords.x + refCoords.width / 2;\r\n  let elCoords = {\r\n    x: coords.x,\r\n    xM: coords.width,\r\n    y: coords.y,\r\n    yM: coords.bottom,\r\n  };\r\n\r\n  let inside =\r\n    middleX > elCoords.x && middleX < elCoords.x + elCoords.xM && middleY > elCoords.y && middleY < elCoords.yM;\r\n  return inside;\r\n};\r\n\r\nexport const setTemp = (draggedElement, setDraggedElement) =>\r\n  setTimeout(() => {\r\n    draggedElement['enable'] = false;\r\n    setDraggedElement(Object.assign(draggedElement));\r\n  }, 200);\r\n","import DragAndDrop from './DragAndDrop';\nmodule.exports = DragAndDrop;\n","import * as FormkitAutoAnimateReact from '@formkit/auto-animate/react';\r\nimport { useEffect, useState } from 'react';\r\nimport {\r\n  addEmpty,\r\n  createElementReferences,\r\n  initialPos,\r\n  isInside,\r\n  moveElement,\r\n  moveElements,\r\n  setTemp,\r\n} from './DandDMethods';\r\n\r\nexport default function DragAndDrop({ duration, list_, contRef, elementclassName, containerclassName }) {\r\n  const [list, setList] = useState(list_);\r\n  const [draggedElement, setDraggedElement] = useState(undefined);\r\n  const [parent, enableAnimations] = FormkitAutoAnimateReact.useAutoAnimate({ duration: duration });\r\n\r\n  useEffect(() => {\r\n    createElementReferences(list_, setList);\r\n  }, [list_]);\r\n\r\n  useEffect(() => {\r\n    if (!draggedElement) return;\r\n\r\n    const handleMouseMove = (evt) => {\r\n      moveElement(draggedElement, evt);\r\n      moveEmptyElement(draggedElement.ref, evt);\r\n    };\r\n\r\n    const handleMouseUp = (evt) => {\r\n      handleDrop(list.findIndex((el) => el._id === 'empty'));\r\n      document.removeEventListener('mousemove', handleMouseMove);\r\n      document.removeEventListener('mouseup', handleMouseUp);\r\n    };\r\n\r\n    document.addEventListener('mousemove', handleMouseMove);\r\n    document.addEventListener('mouseup', handleMouseUp);\r\n  }, [draggedElement]);\r\n\r\n  const moveEmptyElement = (ref) => {\r\n    let draggedEl = list.find((el) => el.dragged);\r\n    let draggedIndex = list.findIndex((el) => el._id === 'empty');\r\n\r\n    for (let i = 0; i < list.length; i++) {\r\n      let el = list[i];\r\n      if (!draggedElement.enable && el !== draggedEl && el._id !== 'empty' && isInside(ref, el)) {\r\n        moveElements(draggedElement, setDraggedElement, list, setList, draggedIndex, i); //set enable animtion to false and set new state\r\n        setTemp(draggedElement, setDraggedElement); //Does not let to move empty until animation is finished\r\n        break;\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDrop = (draggedIndex) => {\r\n    let newList = list.filter((rd) => rd._id !== 'empty');\r\n    newList.splice(draggedIndex, 0, draggedElement);\r\n    setDraggedElement(undefined);\r\n    setList([...newList]);\r\n  };\r\n\r\n  const handleDrag = async (mouseDown, ref) => {\r\n    mouseDown.stopPropagation();\r\n    let draggedEl = list.find((el) => el.ref === ref);\r\n    let draggedIndex = list.findIndex((el) => el.ref === ref);\r\n    initialPos(ref, draggedEl, contRef);\r\n    addEmpty(ref, draggedIndex, draggedEl, list);\r\n    setList(list.filter((r) => r !== draggedEl));\r\n    draggedEl['mouseDown'] = mouseDown;\r\n    setDraggedElement(draggedEl);\r\n  };\r\n\r\n  return (\r\n    <div style={{ display: 'flex' }}>\r\n      {list && (\r\n        <div ref={parent} className={containerclassName}>\r\n          {list.map((l) => {\r\n            return (\r\n              <div\r\n                ref={l.ref}\r\n                className={elementclassName}\r\n                key={l._id}\r\n                onMouseDown={(evt) => handleDrag(evt, l.ref)}\r\n                style={l.extraStyle ? { ...l.extraStyle } : {}}\r\n              >\r\n                {l.renderMethod}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n      {draggedElement && (\r\n        <div\r\n          className=\"dashboardContainer\"\r\n          ref={draggedElement.ref}\r\n          style={{\r\n            position: 'absolute',\r\n            ...draggedElement.extraStyle,\r\n            transform: 'translate(' + draggedElement.x + 'px,' + draggedElement.y + 'px)',\r\n            zIndex: '10000',\r\n          }}\r\n        >\r\n          {draggedElement.renderMethod}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["moveElements","draggedElement","setDraggedElement","list","setList","draggedIndex","i","Object","assign","elements","splice","isInside","ref","el","_el$ref","coords","current","getBoundingClientRect","refCoords","middleY","y","height","middleX","x","width","elCoords","bottom","inside","setTemp","setTimeout","module","exports","_ref","duration","list_","contRef","elementclassName","containerclassName","useState","undefined","parent","enableAnimations","FormkitAutoAnimateReact","useAutoAnimate","useEffect","createElementReferences","length","map","l","createRef","handleMouseMove","evt","moveElement","style","transform","pageX","mouseDown","pageY","moveEmptyElement","handleMouseUp","handleDrop","findIndex","_id","document","removeEventListener","addEventListener","draggedEl","find","dragged","enable","newList","filter","rd","h","display","className","key","onMouseDown","handleDrag","stopPropagation","initialPos","coordsCont","addEmpty","extraStyle","offsetWidth","offsetHeight","r","Promise","resolve","e","reject","renderMethod","position","zIndex"],"mappings":"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"}